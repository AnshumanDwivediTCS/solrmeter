#summary How to use SolrMeter

<wiki:toc max_depth="2" />

=Compile and Run=
First thing you need to do is download SolrMeter, either the compiled jar from the [http://code.google.com/p/solrmeter/downloads/list Downloads] section or the source code from the [http://code.google.com/p/solrmeter/source/checkout Source] section. [http://code.google.com/p/solrmeter/wiki/Usage This] wiki page explains how to compile and run the source code.
Once you start SolrMeter you'll see the initial screen, probably with the “PLay” buttons and the “Optimize Now” button in red. This means that SolrMeter can't find a valid Solr instance on the specified URL (default URL for Solr is http://localhost:8983/solr, which is Solr default, so if you see this buttons in red then you are good to go). 
<a href="http://solrmeter.googlecode.com/svn/wiki/imgs/greenButtons.png"><img src="http://solrmeter.googlecode.com/svn/wiki/imgs/greenButtons.png" height="250" width="450"/></a>
=Execute Queries to a Solr instance=
It's easy to tell SolrMeter to execute queries to your Solr instance. First thing you have to do is to create a text file on your PC with possible queries. Each line of this text file will be included as the “q” parameter of the request to Solr, so it will depend on how you need to test Solr. For example, if your application will use LuceneQueryParser, then a queries file could be something like:
{{{
text:(ipod OR ipad) AND cat:technology
text:(lucene) AND cat:books AND title:(action)
text:display AND cat:technology
….
}}}
on the other hand, if you are using a DismaxQueryParser in Solr, probably your text file will look like:
{{{
ipod ipad
lucene in action
display
technology
…
}}}
It's important to note that these are the queries that will be executed to Solr. [http://code.google.com/p/solrmeter/wiki/queries Here] you can see another example of a queries file. When you are doing a real test, these should be the queries you'll be expecting from your real application (you could extract queries from the logs to create this file). It's also important to have as many different queries as possible, you don't want Solr to keep all the queries on cache because this wouldn't be a good test.
Once you created the queries file with a good number of different queries, you have to tell SolrMeter to use it. Go to the menu “Edit->Settings” and modify the “Queries File Path” property under the “Query Settings” tab. Browse to your file and select it.
<a href="http://solrmeter.googlecode.com/svn/wiki/imgs/selectQueriesFile.png"><img src="http://solrmeter.googlecode.com/svn/wiki/imgs/selectQueriesFile.png" height="250" width="450"/></a><br>
If you don't have Solr on http://localhost:8983/solr and your “Run” button was red, change the “URL Solr” property under the same tab, set the value to your URL.
Press OK (I'll come back to explain what the other properties mean later)
you should now see the “PLay” button in green.<br>
<a href="http://solrmeter.googlecode.com/svn/wiki/imgs/startBlack.png"><img src="http://solrmeter.googlecode.com/svn/wiki/imgs/startBlack.png"/></a><br>
Select the number of queries you want SolrMeter to execute every minute on the “Intended queries per minute” property of the query panel (on the main window). 
Finally, press the “Play” Button.
You'll start seeing the numbers of the Query Console and the statistics changing. I'll explain the query console numbers and later the statistics.
==What does the Query Console numbers mean?==
<a href="http://solrmeter.googlecode.com/svn/wiki/imgs/queryConsole.png"><img src="http://solrmeter.googlecode.com/svn/wiki/imgs/queryConsole.png"/></a><br>
===Total Queries:===
The total number of queries executed on this test.<br>
===Total Query Time:===
The sum of the Query time of all the executed queries in ms. This time is taken from Solr's response (QTime)<br>
===Average Query Time:===
The average of ms the queries take.<br>
===Total Client Time:===
The sum of the Query time of all the executed queries in ms, but measured from SolrMeter instead of Solr's QTime.<br>
===Average Client Time:===
The average of ms the queries take, considering the client time instead of Solr's QTime.<br>
===Test Started At:===
Indicates the moment when the test started.<br>
===Total Errors:===
The total number of queries that resulted in some kind of error in Solr.<br>
===Intended Queries per minute:===
The number of queries you want SolrMeter to execute.<br>
===Actual Queries per minute:===
The number of queries SolrMeter is actually executing (considering the last 10 seconds activity).<br>
===Why is there a difference between “Intended” QPM and “Actual” QPM?===
There are two main reasons why the Actual QPM might be different than the “Intended” QPM value. The “Random” Query executor executes queries without a defined frequency (see [http://code.google.com/p/solrmeter/wiki/Executors this] page to understand why). The “Actual” QPM is calculated with the queries executed on the last 10 seconds; this is why this number will variate, sometimes it will be higher than the Intended QPM, and some times lower.
The other reason why these two numbers can be different (the only reason if you are using the ConstantQueryExecutor) is that SolrMeter simply can't achieve from this machine the number of queries that you intend to. In [http://code.google.com/p/solrmeter/wiki/Benchmarks this] page you'll find some benchmarks on what SolrMeter can or can't do. Of course, if you need more QPM, you could execute two SolrMeter in two different machines, the drawback here is that the statistics are not going to be complete. It might be helpful for some cases thought.
==What are all the other parameters of the “Query Settings” and what are they for?==
===Query Mode (standard / external):===
This setting specify at a high level how you are going to execute your test. With the “external” mode, you have to basically give SolrMeter the exact parameters of the whole search request, including the query itself, filter queries, facets, facet mode, etc. If you select this mode, then you only have to add a text file like:
{{{
q=Apple AND price:[0 TO 100] OR popularity:[0 TO 3]&sort=popularity desc&fq=weight:[10 TO *]&rows=100
}}}
This is an excellent choice if you have a real sample of queries as they are going to be executed on your search application.
The “standard” query mode, lets you execute more “random” requests, you’ll have to specify the [http://code.google.com/p/solrmeter/wiki/queries queries], the [http://code.google.com/p/solrmeter/wiki/fields fields for faceting], the [http://code.google.com/p/solrmeter/wiki/filterqueries filter queries] separated, and then SolrMeter will mix it all to generate the search requests. This option is better for start, when you don’t have real logs.
===Solr URL:===
The url where the “Query Solr” (in case you have master and slave) is located. It has to include the core if you are using multicore.
===Use Facets (true / false):===
Tell SolrMeter if you want to set the attribute “facet=true” and add facet fields.
===Fields File:===
The location of the file that contains the fields on which you want to facet on. You don’t need to specify this file if you are not going to facet. [http://code.google.com/p/solrmeter/wiki/fields see the example file].
===Use Filter Queries (true / false):===
Tell SolrMeter if you want to add filter queries to the search request.
===Filter Query File Path:===
Path to a text file with filter queries on it.[http://code.google.com/p/solrmeter/wiki/filterqueries see the example file].
===Queries File Path:===
Path to a text file with queries on it. [http://code.google.com/p/solrmeter/wiki/queries See the example file].
===Query Type:===
Solr’s query type to use. This is the [http://wiki.apache.org/solr/CoreQueryParameters#qt qt] parameter of a regular request.
===Extra Parameter:===
Here you can add static extra parameter to be used  on the query. For example: "hl=true,hl.fl=text,hl.fragsize=150"
These parameters are going to be added in every search request. Parameters have to be separated by commas.
NOTE: This has changed on trunk, now this has a better and more user-friendly interface.
===Query Executor:===
The query executor to use. See [http://code.google.com/p/solrmeter/wiki/Executors this] page for more details on Query Executors.
===Add Random Extra Parameter (true / false):===
Tell SolrMeter if you want to add (random) extra parameters from an external text file. This is useful when you want to test for example using spatial search. You could have a text file with different locations and distances like:
{{{
&fq={!bbox}&sfield=store&pt=32.15,-93.85&d=5
&fq={!bbox}&sfield=store&pt=17.43,-18.26&d=5
&fq={!bbox}&sfield=store&pt=43.15,-92.53&d=5
&fq={!bbox}&sfield=store&pt=12.45,-23.56&d=5
&fq={!bbox}&sfield=store&pt=29.39,-73.65&d=5
}}}
All those lines are going to be randomly added to the search request. Parameters must be separated by “&”.
===Extra Params file path:===
Path to a text file with the extra parameters to be added to the search request.

==How to add Facets to my queries?==
There are many ways of adding facets to your search depending on your needs. If your application will ALWAYS use the same facet fields, then the best thing to do is to add them as extra parameters as described in the [http://code.google.com/p/solrmeter/wiki/Tutorial#Extra_Parameter: "Add extra parameters"] section of this tutorial. 
If you know that your application will allow facets in some fields, but those will change with each request, you can use the [http://code.google.com/p/solrmeter/wiki/Tutorial#Fields_File: "fields"] file plus set the combo box [http://code.google.com/p/solrmeter/wiki/Tutorial#Use_Facets_(true_/_false): "Use facets" to "true".]
If your application will have different sets of facets (in some cases will facet in field1, field2 and field3 together, but in some other cases will facet in field1, field4 and field5, then you can use the [http://code.google.com/p/solrmeter/wiki/Tutorial#Add_Random_Extra_Parameter_(true_/_false): "random extra parameters"]. This is very similar than using the [http://code.google.com/p/solrmeter/wiki/Tutorial#Query_Mode_(standard_/_external): "external" mode] but you just need to add the extra parameters, not all.
Finally, if you are using the [http://code.google.com/p/solrmeter/wiki/Tutorial#Query_Mode_(standard_/_external): "external" query mode], you'll need to add the facet fields to each request.
==How to add Filter Queries?==
Well, the options here are very similar to the section [http://code.google.com/p/solrmeter/wiki/Tutorial#How_to_add_Facets_to_my_queries? "How to add Facets to my queries"], the only difference is that, instead of "Use Facets" you need to set the combo [http://code.google.com/p/solrmeter/wiki/Tutorial#Use_Filter_Queries_(true_/_false): "Use Filter Queries"] to true, and instead of a "fields" file you'll have to provide a [http://code.google.com/p/solrmeter/wiki/Tutorial#Filter_Query_File_Path: "filters" file]. The other options (extra parameters, extra parameters file and external mode) can be used in the same way as with facets.
==How to add Extra parameters, like highlighting or spellchecking?==
If those are static, they can be added as described in the [http://code.google.com/p/solrmeter/wiki/Tutorial#Extra_Parameter: "Add Extra Parameters"] section. If those will change with each request, the best way to do it is by using the [http://code.google.com/p/solrmeter/wiki/Tutorial#Add_Random_Extra_Parameter_(true_/_false): "Random Extra Params"].
==How can I run the exact same queries that were executed to my production Solr Instance?==
Since Version 0.3.0 (thanks to [http://code.google.com/p/solrmeter/issues/detail?id=90 this] issue you can extract queries from a Solr log and generate an [http://code.google.com/p/solrmeter/wiki/Tutorial#Query_Mode_(standard_/_external): "external queries file"]. This means that the exact same queries (with all of the parameters) will be executed in your test, however, this DOESN'T mean that they are going to be executed in the same order or frequency!. Queries are extracted from the external file RANDOMLY and the original execution time is not maintained, those queries will be executed in a random instant and in a random order. [http://code.google.com/p/solrmeter/issues/detail?id=54 There is an open issue] to execute queries from the queries file in a sequential order, however, it is still not implemented. It should be very simple to implement. [http://code.google.com/p/solrmeter/issues/detail?id=24 There is also an open issue] to record and load tests in order to be able to execute the exact same query with different versions/configurations/servers/whatever.
=What does the statistics mean?=
==Histogram==
This statistic shows the number of queries during the test that fall into the different buckets of [http://code.google.com/p/solrmeter/issues/detail?id=100 100 milliseconds]. SolrMeter uses Solr's QTime to build this chart.
See http://code.google.com/p/solrmeter/wiki/Screenshots#Histogram
==Pie Chart==
This statistic shows in a pie diagram the percentage of queries that fall into the different time intervals. By default the intervals are: 
From 0 to 500 ms
From 501 to 1000 ms
From 1001 to 2000 ms
More than 2000 ms
But those intervals can be changed by pressing the "Customize" button.
See http://code.google.com/p/solrmeter/wiki/Screenshots#Pie_Chart1
==Query Time History==
This statistic shows how the average query time evolved during the test. Every 10 seconds SolrMeter calculates the average (only considering the queries executed in the last 10 seconds) and displays it in another column of the diagram. It will show if during the test, there is something that is causing the average query time to increase (like an optimize could do, or a big segment merge).
http://code.google.com/p/solrmeter/wiki/Screenshots#Query_History
==Operations Time Line==
This Statistic shows together in one chart how long are the different operations taking. Each query is plotted into the chart, as every update, every commit and every optimize (Only those operations executed by SolrMeter are plotted, if you are using Solr's autocommit or committing from another process for example, the commit operation will not be added to the chart).
This diagram is useful to see if some operations are introducing latency to others.
See http://code.google.com/p/solrmeter/wiki/Screenshots#Time_Line
==Query Statistic==
This statistic shows in a table the last 400 executed queries, their status, QTime and result count. It also shows some statistics information about the current test like Median, Mode, Variance, Standard Deviation, Total Average, Last Minute Average, Last 10 minute average plus the last error date.
See http://code.google.com/p/solrmeter/wiki/Screenshots#Query_Statistics
=How to execute Updates?=
=What does the Commit parameters mean?=
=How can I save / load the settings for my test? How can I change the default?=